---
const { label, href, count, categoryKey } = Astro.props as {
  label: string;
  href: string;
  count?: number;
  categoryKey?: string;
};

function bgClassFor(key: string) {
  switch (key) {
    case "home":
      return "bg-gradient-to-br from-emerald-600 via-emerald-500 to-teal-400";
    case "tech":
      return "bg-gradient-to-br from-blue-700 via-indigo-600 to-violet-500";
    case "pets":
      return "bg-gradient-to-br from-amber-600 via-orange-500 to-rose-500";
    case "kids":
      return "bg-gradient-to-br from-pink-600 via-fuchsia-500 to-purple-500";
    case "travel":
      return "bg-gradient-to-br from-sky-700 via-cyan-600 to-emerald-400";
    case "health":
      return "bg-gradient-to-br from-slate-800 via-slate-700 to-slate-500";
    case "family":
      return "bg-gradient-to-br from-stone-700 via-stone-600 to-amber-500";
    default:
      return "bg-gradient-to-br from-gray-800 via-gray-700 to-gray-500";
  }
}

const k = String(categoryKey || "").trim().toLowerCase();
const bgClass = bgClassFor(k);
const imageSrcByKey: Record<string, string> = {
  home: "/images/category_assets/home.PNG",
  tech: "/images/category_assets/tech.PNG",
  pets: "/images/category_assets/pets.PNG",
  travel: "/images/category_assets/travel.PNG",
  family: "/images/category_assets/essentials.PNG",
  essentials: "/images/category_assets/essentials.PNG",
};
const imageSrc = imageSrcByKey[k];
const hasImage = typeof imageSrc === "string" && imageSrc.length > 0;
const aria =
  typeof count === "number" ? `${label} (${count})` : String(label || "").trim();
---

<a
  href={href}
  aria-label={aria}
  class="group block overflow-hidden rounded-2xl border border-gray-200 bg-white shadow-sm transition hover:border-gray-300 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2"
>
  <div class:list={["relative aspect-[3/4]", bgClass]}>
    {hasImage ? (
      <img
        src={imageSrc}
        alt=""
        loading="lazy"
        decoding="async"
        class="absolute inset-0 h-full w-full object-cover"
      />
    ) : null}
    {hasImage ? <div class="absolute inset-0 bg-black/15"></div> : null}

    <div
      class:list={[
        "absolute inset-0 bg-[radial-gradient(600px_220px_at_20%_15%,rgba(255,255,255,0.95),transparent_60%)]",
        hasImage ? "opacity-[0.10]" : "opacity-[0.16]",
      ]}
    ></div>

    {!hasImage ? (
      <div class="absolute inset-0 grid place-items-center">
        <div class="rounded-2xl bg-white/12 p-4 backdrop-blur-[2px]">
          {k === "home" ? (
            <svg width="42" height="42" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="text-white">
              <path d="M3 10.5L12 3l9 7.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M5.5 9.5V21h13V9.5" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
              <path d="M9.5 21v-7h5v7" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
          ) : k === "tech" ? (
            <svg width="42" height="42" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="text-white">
              <path d="M4 6h16v10H4V6Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
              <path d="M8 20h8" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
              <path d="M10 16v4M14 16v4" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          ) : k === "pets" ? (
            <svg width="42" height="42" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="text-white">
              <path d="M7.5 11.5c-1.5 0-2.5-1.2-2.5-2.6C5 7.6 5.9 6.5 7.2 6.5c1.4 0 2.3 1.1 2.3 2.4 0 1.6-.9 2.6-2 2.6Z" stroke="currentColor" stroke-width="2" />
              <path d="M16.5 11.5c1.5 0 2.5-1.2 2.5-2.6 0-1.3-.9-2.4-2.2-2.4-1.4 0-2.3 1.1-2.3 2.4 0 1.6.9 2.6 2 2.6Z" stroke="currentColor" stroke-width="2" />
              <path d="M12 21c-2.8 0-5-1.8-5-4.2 0-1.3.7-2.5 1.8-3.2 1-.7 1.7-1.9 3.2-1.9 1.5 0 2.2 1.2 3.2 1.9 1.1.7 1.8 1.9 1.8 3.2C17 19.2 14.8 21 12 21Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
            </svg>
          ) : k === "travel" ? (
            <svg width="42" height="42" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="text-white">
              <path d="M2 12l20-8-8 20-2-9-10-3Z" stroke="currentColor" stroke-width="2" stroke-linejoin="round" />
              <path d="M12 15l10-11" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          ) : (
            <svg width="42" height="42" viewBox="0 0 24 24" fill="none" aria-hidden="true" class="text-white">
              <path d="M12 2v20M2 12h20" stroke="currentColor" stroke-width="2" stroke-linecap="round" />
            </svg>
          )}
        </div>
      </div>
    ) : null}

    <div class="absolute inset-x-0 bottom-0">
      <div class="h-16 bg-gradient-to-t from-black/75 via-black/35 to-transparent"></div>
      <div class="absolute inset-x-0 bottom-0 p-3">
        <div class="flex items-end justify-between gap-3">
          <div class="min-w-0">
            <div class="truncate text-sm font-semibold text-white drop-shadow-[0_1px_2px_rgba(0,0,0,0.75)]">
              {label}
            </div>
          </div>
          {typeof count === "number" ? (
            <div class="shrink-0 text-xs font-semibold text-white/90 drop-shadow-[0_1px_2px_rgba(0,0,0,0.75)]">
              ({count})
            </div>
          ) : null}
        </div>
      </div>
    </div>
  </div>
</a>
