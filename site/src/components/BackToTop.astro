---
const {
  threshold = 400, // px scrolled before showing
  ariaLabel = "Back to top",
} = Astro.props;
---

<button
  id="back-to-top"
  type="button"
  aria-label={ariaLabel}
  class="fixed bottom-6 right-6 z-50 hidden items-center justify-center rounded-full border border-gray-200 bg-white p-3 text-gray-900 shadow-lg shadow-black/10 transition hover:bg-gray-50 focus:outline-none focus-visible:ring-2 focus-visible:ring-blue-600 focus-visible:ring-offset-2"
>
  <svg
    aria-hidden="true"
    xmlns="http://www.w3.org/2000/svg"
    viewBox="0 0 24 24"
    fill="none"
    stroke="currentColor"
    stroke-width="2"
    stroke-linecap="round"
    stroke-linejoin="round"
    class="h-5 w-5"
  >
    <path d="M12 19V5" />
    <path d="M5 12l7-7 7 7" />
  </svg>
</button>

<script define:vars={{ THRESHOLD: threshold }}>
  (() => {
    const btn = document.getElementById("back-to-top");
    if (!(btn instanceof HTMLButtonElement)) return;

    const prefersReduced =
      typeof window !== "undefined" &&
      typeof window.matchMedia === "function" &&
      window.matchMedia("(prefers-reduced-motion: reduce)").matches;

    const setVisible = (visible) => {
      btn.classList.toggle("hidden", !visible);
      btn.classList.toggle("inline-flex", visible);
    };

    const onScroll = () => {
      setVisible(window.scrollY > Number(THRESHOLD || 0));
    };

    btn.addEventListener("click", () => {
      const behavior = prefersReduced ? "auto" : "smooth";
      window.scrollTo({ top: 0, behavior });
    });

    window.addEventListener("scroll", onScroll, { passive: true });
    onScroll();
  })();
</script>
